---
import Tag from "./Tag.astro";
import CopyButton from "./CopyButton.astro";
import Icon from "./Icon.astro";

type Props = {
  profile: {
    name: string;
    headline: string;
    summary: string;
    location: string;
    email: string;
    phone: string;
    linkedin: string;
    photo: string;
    socials: { label: string; href: string }[];
    ctas: { primary: { label: string; href: string }; secondary: { label: string; href: string; note?: string } };
    stack?: string[];
    highlights: { label: string; value: string }[];
  };
};

const { profile } = Astro.props as Props;

const socialIcon = (label: string) => {
  const key = label.trim().toLowerCase();
  if (key.includes("linkedin")) return "linkedin";
  if (key.includes("whatsapp") || key === "wa") return "whatsapp";
  if (key.includes("email")) return "email";
  if (key.includes("cert")) return "certificate";
  return "external";
};
---
<section class="container-pad pt-10 sm:pt-14" id="top">
  <div class="reveal grid gap-4 md:grid-cols-12">
    <!-- Main hero card -->
    <div class="glass md:col-span-7 p-6 sm:p-8">
      <div class="flex flex-col gap-6 sm:flex-row sm:items-start">
        <div class="relative shrink-0">
          <div class="absolute -inset-1 rounded-xl2 bg-gradient-to-br from-accent/60 to-accent-2/50 blur-md"></div>
          <img
            src={profile.photo}
            alt={`Foto ${profile.name}`}
            class="relative h-24 w-24 sm:h-32 sm:w-32 shrink-0 rounded-xl2 border border-border/70 bg-muted/40 object-cover object-center"
            loading="eager"
          />
        </div>

        <div class="min-w-0">
          <p class="text-xs text-muted-fg">{profile.location}</p>
          <h1 class="mt-2 text-3xl sm:text-4xl font-semibold tracking-tight">{profile.name}</h1>
          <p class="mt-2 text-sm sm:text-base text-muted-fg">{profile.headline}</p>
          <p class="mt-4 text-sm leading-relaxed text-fg/90">{profile.summary}</p>

          <div class="mt-5 flex flex-wrap gap-2">
            <a class="btn btn-primary" href={profile.ctas.primary.href}>{profile.ctas.primary.label} →</a>
            <a class="btn" href={profile.ctas.secondary.href} target="_blank" rel="noreferrer">
              {profile.ctas.secondary.label}
            </a>
          </div>

          <div class="mt-6 flex flex-wrap items-center gap-2 text-sm">
            <a class="link inline-flex items-center gap-2 text-muted-fg hover:text-fg" href={profile.linkedin} target="_blank" rel="noreferrer">
              <Icon name="linkedin" size={16} />
              LinkedIn
            </a>
            <span class="text-border">•</span>
            <a class="link inline-flex items-center gap-2 text-muted-fg hover:text-fg" href={`mailto:${profile.email}`}>
              <Icon name="email" size={16} />
              {profile.email}
            </a>
            <CopyButton value={profile.email} label="Copy Email" />
          </div>
        </div>
      </div>
    </div>

    <!-- Side bento -->
    <div class="md:col-span-5 grid gap-4">
      <div class="glass p-6">
        <p class="text-xs uppercase tracking-wide text-muted-fg">Highlights</p>
        <div class="mt-4 grid gap-3 sm:grid-cols-3 md:grid-cols-1">
          {profile.highlights.map((h) => (
            <div class="rounded-xl2 border border-border/70 bg-muted/40 p-3">
              <p class="text-xs text-muted-fg">{h.label}</p>
              <p class="mt-1 text-sm font-medium">{h.value}</p>
            </div>
          ))}
        </div>
      </div>

      <div class="glass p-6">
        <p class="text-xs uppercase tracking-wide text-muted-fg">Quick links</p>
        <div class="mt-4 flex flex-wrap gap-2">
          {profile.socials.map((s) => (
            <a
              class="btn px-3 py-1.5 inline-flex items-center gap-2"
              href={s.href}
              target={s.href.startsWith("http") ? "_blank" : undefined}
              rel="noreferrer"
            >
              <Icon name={socialIcon(s.label) as any} size={16} />
              <span>{s.label}</span>
              <Icon name="external" size={16} className="opacity-70" />
            </a>
          ))}
        </div>

        <div class="mt-5 rounded-xl2 border border-border/70 bg-muted/30 p-4">
          <p class="text-xs text-muted-fg">Contact</p>
          <div class="mt-1 flex flex-wrap items-center gap-2 text-sm">
            <span>{profile.phone}</span>
            <span class="text-border">•</span>
            <a
              class="link inline-flex items-center gap-2 text-muted-fg hover:text-fg"
              href={`https://wa.me/${profile.phone.replace(/\D/g, "")}`}
              target="_blank"
              rel="noreferrer"
              aria-label="Chat via WhatsApp"
            >
              <Icon name="whatsapp" size={16} />
              WhatsApp
            </a>
          </div>
          <a class="mt-2 inline-block text-sm link text-muted-fg hover:text-fg" href={`mailto:${profile.email}`}>Let’s talk →</a>
        </div>
      </div>

      <div class="glass p-6">
        <p class="text-xs uppercase tracking-wide text-muted-fg">Stack</p>
        <div class="mt-4 flex flex-wrap gap-2">
          {profile.stack?.map((t) => <Tag text={t} />)}
        </div>
      </div>
    </div>
  </div>
</section>
